## 飞书快捷登录接口

**接口描述**：此接口用于绑定飞书账号的用户快速登录系统

`[POST] /api/qrLogin`

**请求参数**

| 参数     | 类型 | 说明                                                 |
| -------- | ---- | ---------------------------------------------------- |
| redirect_uri | str  | 鉴权过程完成后重定向的页面 |
| code    | str  | 飞书客户端返回的code，用于后续鉴权流程                 |


**成功响应参数**

| 参数      | 类型 | 说明             |
| --------- | ---- | ---------------- |
| session   | str  | 用户的会话标识符 |
| character | int  | 用户的角色类型   |

**失败响应状态**

| 状态码 | 错误信息                         | 说明                                |
| ------ | -------------------------------- | ----------------------------------- |
| 2      | 提供的飞书用户未绑定用户           | 提供的飞书用户未绑定用户 |
| 5      | 您已被锁定 | 被锁定的用户无法登录  |

<details>
 <summary>示例</summary>
 <details>
  <summary>请求</summary>

```json
{
  "redirect_uri":"https//:www.baidu.com",
  "code":"abababababab"
}
```
</details>
<details>
  <summary>响应</summary>

```json
    {
    "code":0,
    "data":
      {
      "session":"Rd8Gs0jw0jdbUeJzf7EIBwkwr7aYit74",
      "character":1
      }
    }
```
</details>
</details>

## 绑定飞书账号接口

**接口描述**：此接口用于用户绑定飞书账号

`[PUT] /api/feishu_name/{session}`

**请求参数**

| 参数     | 类型 | 说明                                                 |
| -------- | ---- | ---------------------------------------------------- |
| feishu_name | str  | 绑定的飞书用户名 |
| feishu_phone    | str  | 绑定的飞书电话号码                |

无成功响应参数，接口调用成功则用户信息被修改，返回Succeed

**失败响应状态**

| 状态码 | 错误信息                         | 说明                                |
| ------ | -------------------------------- | ----------------------------------- |
| 9     | 该飞书用户名对应的用户已经存在           | 该飞书用户名对应的用户已经存在 |
| 10     | 该飞书电话号码对应的用户已经存在 | 该飞书电话号码对应的用户已经存在 |
| 11     | 飞书用户名与飞书电话号码不匹配 | 即输入的飞书用户名与飞书电话号码不匹配 |

<details>
 <summary>示例</summary>
 <details>
  <summary>请求</summary>

```json
{
  "feishu_name":"xpy",
  "feishu_phone":"114514"
}
```
</details>
<details>
  <summary>响应</summary>

```json
{
  "code":0,
  "info":"Success",
}
```
</details>
</details>

## 同步飞书用户接口

**接口描述**：此接口用于绑定飞书账号的系统管理员同步飞书用户

`[POST] /api/feishu_users/{session}`

**请求参数**

无请求参数             

**成功响应参数**
无成功响应参数，接口调用成功则同步飞书用户成功，返回Succeed

**失败响应状态**

| 状态码 | 错误信息                         | 说明                                |
| ------ | -------------------------------- | ----------------------------------- |
| 6     | 找不到管理员的实体           | 对应系统管理员的业务实体不存在 |
| 7     | 管理员尚未绑定飞书用户 | 如果管理员尚未绑定飞书用户，自然无法进行同步飞书用户的操作 |

<details>
 <summary>示例</summary>
 <details>
  <summary>请求</summary>
无

</details>
<details>
  <summary>响应</summary>

```json
{
  "code":0,
  "info":"Success",
}
```
</details>
</details>

## 同步更新飞书新增用户接口

**接口描述**：此接口用于在系统中同步更新飞书新增用户(注意该接口并不是由系统的前端调用的，而是在飞书有新用户进入企业后，由飞书客户端通过事件推送向后端发送一个请求并调用该api处理)
`[POST] /api/feishu_get_event`

*请求参数**

| 参数     | 类型 | 说明                                                 |
| -------- | ---- | ---------------------------------------------------- |
| user_id | str  | 入职用户的飞书user_id |
| name    | str  | 入职用户的姓名               |
| mobile   | str  | 入职用户的电话号码                |

**成功响应参数**
无成功响应参数，接口调用成功则同步更新飞书用户成功，返回Succeed

**失败响应状态**

该api的失败可能原因是飞书与系统的通信出现问题

<details>
 <summary>示例</summary>
 <details>
  <summary>请求</summary>
  
```json
{
    "event": {
        "object": {
            "user_id": "e33ggbyz",
            "name": "张三",
            "mobile": "12345678910",
        }
    }
}
```
</details>
<details>
  <summary>响应</summary>

```json
{
  "code":0,
  "info":"Success",
}
```
</details>
</details>

## 飞书审批接口

**接口描述**：此接口用于飞书审批后在系统中同步更新审批结果(注意该接口并不是由系统的前端调用的，而是在飞书在用户进行审批后，由飞书客户端向后端发送一个请求并调用该api处理)

`[POST] /api/feishu_approval`

**请求参数**

| 参数     | 类型 | 说明                                                 |
| -------- | ---- | ---------------------------------------------------- |
| action_type | str  | 记录用户是同意还是拒绝该请求，同意则为"APPROVE",拒绝则为"REJECT" |
| message_id   | str  | 该请求在飞书中的消息卡片id               |


**成功响应参数**
无成功响应参数，接口调用成功则同步更新飞书用户成功，返回Succeed

**失败响应状态**

| 状态码 | 错误信息                         | 说明                                |
| ------ | -------------------------------- | ----------------------------------- |
| 1     | 对应id不存在           | 找不到对应id的待处理请求 |
| 11     | 操作类型无效! | action_type的值不是"APPROVE"或者"REJECT"其中之一 |
| 2     | 资产不存在 | 操作的资产不存在 |
| 2     | 指定名称的资产管理员不存在 | 操作指定的资产管理员不存在 |
| 2     | 只有用户才能接收资产 | 选择的资产接收者不是一级用户 |
| 2     | 只有用户才能退库资产 | 选择的资产退库者不是一级用户 |
| 2     | 转移发起人必须是用户 | 选择的资产转移人不是一级用户 |
| 2     | 指定名字的资产树结点不存在 | 资产转移时指定名字的资产树结点不存在 |
| 2     | 资产接收者与资产管理人不在同一部门下 | 用户只能同一部门下资产管理员发送请求 |
| 2     | 资产退库者与资产管理人不在同一部门下 | 用户只能同一部门下资产管理员发送请求 |
| 2     | 资产转移者与资产管理人不在同一部门下 | 用户只能同一部门下资产管理员发送请求 |
| 3     | 资产{asset.name}不是数量类型资产，请再次检查 | 请求的条目型资产数目大于1 |
| 4     | 资产{asset.name}数量不足 | 请求的资产数目不足 |
| 250     | 如果您不想要此资产，请什么都不做，而不是浪费时间 | 请求领用资产数小于等于0 |
| 250     | 如果您不想退库此资产，请什么都不做，而不是浪费时间 | 请求退库资产数小于等于0 |
| 250     | 如果您不想要转移此资产，请什么都不做，而不是浪费时间 | 请求转移资产数小于等于0 |
| 529    | 未进行任何转移 | 未进行任何转移 |


<details>
 <summary>示例</summary>
 <details>
  <summary>请求</summary>
  
```json
{
    "action_type":"APPROVE",
    "message_id":"qewqdadfwefsf",
}
```
</details>
<details>
  <summary>响应</summary>

```json
{
  "code":0,
  "info":"Success",
}
```
</details>
</details>